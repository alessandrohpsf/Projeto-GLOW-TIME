<!DOCTYPE HTML>
<html lang="pt-BR">
	<head>
		<title>GlowTime - Agendamento</title>
		<link rel="icon" 
              type="png" 
              href="images/logo_brilho.png" />
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="css/main.css" />
		<noscript><link rel="stylesheet" href="css/noscript.css" /></noscript>

		<script type="text/javascript" src="https://cdn.emailjs.com/dist/email.min.js"></script>
		<script src="js/agendamento.js"></script>

		
		<!-- toast -->
		<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper" class="fade-in">

				<div id="intro">
					<a href="#" class="image"><img src="images/Logo_GLOWTIME.png" alt="" /></a>
				 </div>

			    
				<!-- Nav -->
					<nav id="nav">
						<ul class="links">
							<li><a href="index.html">Inicio</a></li>
							<li class="active"><a href="agendamento.html">Agendamento</a></li>
							<li><a href="contato.html">Contato</a></li>
						</ul>
						<ul class="icons">
							<li><a href="https://www.instagram.com/" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
						</ul>
					</nav>

				<!-- Main -->
					<div id="main">

						<!-- Post -->
							<section class="post">
								<header class="major">
								
									<h1>Faça<br />
									seu agendamento</h1>							    
								</header>

								<!-- Form -->

									<form name="form-schedule" id="form-schedule" method="post" action="#" >

										<div class="row gtr-uniform" >
											
											<div class="col-6 col-12-xsmall">
												<input type="text" name="schedule-name" id="nome" value="" placeholder="Nome" required/>
											</div>

											<div class="col-6 col-12-xsmall">
												<input type="text" name="schedule-phone" id="telefone" value="" placeholder="Telefone" required/>
											</div>

											<div class="col-12">
												<input type="email" name="schedule-email" id="email" value="" placeholder="E-mail" required/>
											</div>

											<div class="col-12">
												<select name="demo-category" id="servico">
													<option value="">Serviços</option>
													<option value="Aroma Essence">Aroma Essence</option>
												</select>
											</div>

											
											<div class="col-6 col-12-xsmall">
												<select name="schedule-date" id="data" required>
													<option value="" disabled selected>Selecione uma data</option>
													<option value="2024-11-06">06/11/2024</option>
													<option value="2024-11-07">07/11/2024</option>
													<option value="2024-11-08">08/11/2024</option>
												</select>
												
												<script>
													function removePastDates() {
														const select = document.getElementById('date-selector');
														const now = new Date();
														now.setHours(0, 0, 0, 0); // Zera a hora para comparar apenas a data
												
														for (let i = select.options.length - 1; i >= 1; i--) {
															const option = select.options[i];
															const optionDate = new Date(option.value);
												
															if (optionDate < now) {
																select.remove(i); // Remove a opção de data passada
															}
														}
													}
												
													// Chama a função ao carregar a página
													window.onload = removePastDates;
												
													// Atualiza a cada dia para remover datas passadas em tempo real (ajuste de 24h)
													setInterval(removePastDates, 86400000);
												</script>
												
											</div>

											<div class="col-6 col-12-xsmall">
												<select name="schedule-time" id="horario" required>
													<option value="" disabled selected>Selecione uma hora</option>
													<option value="9:00">9:00</option>
                                                    <option value="9:05">9:05</option>
                                                    <option value="9:10">9:10</option>
                                                    <option value="9:15">9:15</option>
                                                    <option value="9:20">9:20</option>
                                                    <option value="9:25">9:25</option>
                                                    <option value="9:30">9:30</option>
                                                    <option value="9:35">9:35</option>
                                                    <option value="9:40">9:40</option>
                                                    <option value="9:45">9:45</option>
                                                    <option value="9:50">9:50</option>
                                                    <option value="9:55">9:55</option>
                                                    <option value="10:00">10:00</option>
                                                    <option value="10:05">10:05</option>
                                                    <option value="10:10">10:10</option>
                                                    <option value="10:15">10:15</option>
                                                    <option value="10:20">10:20</option>
                                                    <option value="10:25">10:25</option>
                                                    <option value="10:30">10:30</option>
                                                    <option value="10:35">10:35</option>
                                                    <option value="10:40">10:40</option>
                                                    <option value="10:45">10:45</option>
                                                    <option value="10:50">10:50</option>
                                                    <option value="10:55">10:55</option>
													<option value="15:00">15:00</option>
													<option value="15:05">15:05</option>
													<option value="15:10">15:10</option>
													<option value="15:15">15:15</option>
													<option value="15:20">15:20</option>
													<option value="15:25">15:25</option>
													<option value="15:30">15:30</option>
													<option value="15:35">15:35</option>
													<option value="15:40">15:40</option>
													<option value="15:45">15:45</option>
													<option value="15:50">15:50</option>
													<option value="15:55">15:55</option>
													<option value="16:00">16:00</option>
													<option value="16:05">16:05</option>
													<option value="16:10">16:10</option>
													<option value="16:15">16:15</option>
													<option value="16:20">16:20</option>
													<option value="16:25">16:25</option>
													<option value="16:30">16:30</option>
													<option value="16:35">16:35</option>
													<option value="16:40">16:40</option>
													<option value="16:45">16:45</option>
													<option value="16:50">16:50</option>
													<option value="16:55">16:55</option>
													<option value="23:55">23:55</option>

												</select>
												
												<script>
													function removePastTimes() {
														const select = document.getElementById('horario');
														const now = new Date();
														const currentTime = now.getHours() * 60 + now.getMinutes(); // Hora atual em minutos desde o início do dia
												
														for (let i = select.options.length - 1; i >= 1; i--) {
															const option = select.options[i];
															const [hour, minute] = option.value.split(':').map(Number);
															const optionTime = hour * 60 + minute; // Hora da opção em minutos desde o início do dia
												
															if (optionTime <= currentTime) {
																select.remove(i); // Remove a opção passada
															}
														}
													}
												
													// Chama a função ao carregar a página
													window.onload = removePastTimes;
												
													// Atualiza a cada minuto para remover horários passados em tempo real
													setInterval(removePastTimes, 60000);
												</script>
												
												
											</div>

											<!-- Break -->
											<div class="col-12">
												<ul class="actions">
													<!-- Enviar -->
													<li><input type="submit" class="primary" onclick="agendarServico()"/> </li>
													<!-- Limpar -->
													<li><input type="reset"/></li>
												</ul>
											</div>

										</div>
									</form>
			</div>	

</div>

<script>

	function agendarServico(event) {
	
		// Coleta os valores dos campos do formulário
		const nome = document.getElementById("nome").value;
		const telefone = document.getElementById("telefone").value;
		const email = document.getElementById("email").value;
		const servico = document.getElementById("servico").value;
		const data_agenda = document.getElementById("data_agenda").value;
		const horario = document.getElementById("horario").value;
	
		// Cria o objeto de dados para enviar
		const agendamentoData = { nome, telefone, email, servico, data_agenda, horario };
	
		// Faz o POST para a URL /api/form usando fetch
		fetch('https://grow-back.onrender.com/api/agendar', {
			method: 'POST',
			headers: {
				'Content-Type': 'application/json'
			},
			body: JSON.stringify(agendamentoData)
		})
		.then(response => {
			if (!response.ok) {
				throw new Error('Erro ao enviar o formulário');
			}
			return response.json();
		})
		.then(data => {
			console.log("Formulário enviado com sucesso:", data);
			limparFormulario(); // Limpa o formulário
			carregarAgendamentos(); // Atualiza a lista de agendamentos
		})
	  
	}
	
	function limparFormulario() {
		document.getElementById("form-schedule").reset();
	}
		
</script>

		<!-- Scripts -->
			<script src="js/jquery.min.js"></script>
			<script src="js/jquery.scrollex.min.js"></script>
			<script src="js/jquery.scrolly.min.js"></script>
			<script src="js/browser.min.js"></script>
			<script src="js/breakpoints.min.js"></script>
			<script src="js/util.js"></script>
			<script src="js/main.js"></script>



			<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
            <script>
               emailjs.init("YgXGvFXBtAVSsBzZU"); // Substitua "YOUR_USER_ID" pelo seu ID da EmailJS
            </script>
              
            
			<!-- toast -->
			<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

	</body>
</html>